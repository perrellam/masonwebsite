if (self.CavalryLogger) { CavalryLogger.start_js(["LTdcY"]); }

__d("XConversationNubTogglePinController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/ajax\/conversation\/nub_story\/toggle_pin\/",{ft_id:{type:"String"},pin:{type:"Bool",defaultValue:false},with_render:{type:"Bool",defaultValue:false},notif_setting:{type:"Enum",enumType:1}});}),null);
__d('ConversationNubUtils',['csx','Arbiter','AsyncFeature','AsyncRequest','DOM','Event','EventListener','Keys','XConversationNubTogglePinController','XConversationsToggleController'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={DISABLE:'disable',ENABLE:'enable'},j='ConversationNubUtils/closeTab',k='ConversationNubUtils/unpinnedFromHeader',l='ConversationNubUtils/recheckTabVisibility',m='ConversationNubUtils/openPermalinkFromHeader',n='ConversationNubUtils/turnOff',o='ConversationNubUtils/turnOn',p='tab-x-out',q='overflow-x-out',r='unpin';function s(la){var ma=Object.values(i);return ma.find(function(na){return na===la;})||null;}function t(la,ma,na,oa){var pa=oa||{},qa=pa.notif_setting,ra=c('XConversationNubTogglePinController').getURIBuilder().setString('ft_id',String(la)).setBool('pin',ma);if(qa&&c('AsyncFeature').__serverHasFeatureImpl(3))ra.setEnum('notif_setting',qa);var sa=ra.getURI(),ta=new (c('AsyncRequest'))().setURI(sa).setMethod('POST');if(na)ta.setAllowCrossPageTransition(true);ta.send();}function u(la){var ma=c('XConversationsToggleController').getURIBuilder().setBool('turn_conversations_on',la).getURI();la?ka():ja();var na=new (c('AsyncRequest'))().setURI(ma).setAllowCrossPageTransition(true).setHandler(function(oa){if(oa.getPayload().conversationsStatus){ka();}else ja();}).setErrorHandler(function(oa){la?ja():ka();}).setMethod('POST');na.send();}function v(la,ma,na){t(la,true,ma,na);}function w(la,ma,na){t(la,false,ma,na);}function x(la,ma){v(la,false,ma);}function y(la,ma){w(la,false,ma);}function z(la,ma){v(la,true,ma);}function aa(la,ma){w(la,true,ma);}function ba(){u(false);}function ca(){u(true);}function da(la){return c('DOM').scry(la,"._4iz6")[0];}function ea(la,ma,na){var oa=function pa(){na();};ma.addSubscriptions(c('EventListener').listen(la,'click',oa),c('EventListener').listen(la,'keydown',function(pa){if(c('Event').getKeyCode(pa)===c('Keys').RETURN)oa();}));}function fa(la,ma,na){c('Arbiter').inform(j,{tabID:la,tab:ma,reason:na});}function ga(la){c('Arbiter').inform(k,{tabID:la});}function ha(la){c('Arbiter').inform(l,{tab:la});}function ia(la){c('Arbiter').inform(m,{tabID:la});}function ja(){c('Arbiter').inform(n,{});}function ka(){c('Arbiter').inform(o,{});}f.exports={CLOSE_TAB_EVENT:j,UNPIN_FROM_HEADER_EVENT:k,OPEN_PERMALINK_FROM_HEADER_EVENT:m,TURN_CONVERSATIONS_OFF_EVENT:n,TURN_CONVERSATIONS_ON_EVENT:o,CLOSE_REASON_TAB_X_OUT:p,CLOSE_REASON_OVERFLOW_X_OUT:q,CLOSE_REASON_UNPIN:r,coerceToPinRequestNotifSetting:s,sendPinRequest:x,sendUnpinRequest:y,sendPinRequestAcrossTransitions:z,sendUnpinRequestAcrossTransitions:aa,getCloseButtonElem:da,addCloseButtonListeners:ea,informShouldCloseTab:fa,informDidUnpinFromHeaderMenu:ga,informShouldRecheckTabVisibility:ha,informOpenPermalinkFromHeader:ia,turnConversationsOff:ba,turnConversationsOn:ca};}),null);
__d('ConversationNubHeader',['csx','ArbiterMixin','Bootloader','ConversationNubUtils','DOM','Event','EventListener','Keys','SubscriptionsHandler','ifRequired','mixin'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();function k(m,n){return c('EventListener').listen(m,'keydown',function(o){if(c('Event').getKeyCode(o)===c('Keys').RETURN)n(o);});}i=babelHelpers.inherits(l,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function l(m,n){j.constructor.call(this);this.$ConversationNubHeader1=m;this.$ConversationNubHeader3=n;this.$ConversationNubHeader4=null;this.$ConversationNubHeader5=false;this.$ConversationNubHeader2=new (c('SubscriptionsHandler'))();this.$ConversationNubHeader6();}l.prototype.$ConversationNubHeader6=function(){var m=this.$ConversationNubHeader1;this.$ConversationNubHeader2.addSubscriptions(c('EventListener').listen(m,'click',this.$ConversationNubHeader7.bind(this)));var n=c('ConversationNubUtils').getCloseButtonElem(m);if(n)c('ConversationNubUtils').addCloseButtonListeners(n,this.$ConversationNubHeader2,this.$ConversationNubHeader8.bind(this));var o=this.$ConversationNubHeader9();if(o)this.$ConversationNubHeader2.addSubscriptions(c('EventListener').listen(o,'click',this.$ConversationNubHeader10.bind(this)),k(o,this.$ConversationNubHeader10.bind(this)));var p=this.$ConversationNubHeader11();if(p)this.$ConversationNubHeader2.addSubscriptions(c('EventListener').listen(p,'click',this.$ConversationNubHeader12.bind(this)),c('EventListener').listen(p,'mouseover',this.$ConversationNubHeader13.bind(this)),c('EventListener').listen(p,'focus',this.$ConversationNubHeader14.bind(this)),k(p,this.$ConversationNubHeader15.bind(this)));};l.prototype.$ConversationNubHeader11=function(){return c('DOM').scry(this.$ConversationNubHeader1,"._1rf1")[0];};l.prototype.$ConversationNubHeader9=function(){return c('DOM').scry(this.$ConversationNubHeader1,"._4a56")[0];};l.prototype.$ConversationNubHeader16=function(){return c('ConversationNubUtils').getCloseButtonElem(this.$ConversationNubHeader1);};l.prototype.$ConversationNubHeader8=function(){this.inform('closeButton');};l.prototype.$ConversationNubHeader10=function(m){if(m.type==='click')m.kill();this.inform('minimizeButton');};l.prototype.$ConversationNubHeader7=function(){this.inform('clickHeader');};l.prototype.$ConversationNubHeader17=function(){this.inform('showMenu');};l.prototype.$ConversationNubHeader18=function(){this.inform('hideMenu');var m=this.$ConversationNubHeader11();m&&m.blur();};l.prototype.$ConversationNubHeader19=function(){this.inform('menuPermalinkClick');};l.prototype.$ConversationNubHeader20=function(m){if(this.$ConversationNubHeader4)return;var n=this.$ConversationNubHeader11();if(!n)return;if(m)this.$ConversationNubHeader5=true;c('Bootloader').loadModules(["React","ReactDOM","ConversationNubHeaderMenu.react"],function(o,p,q){var r=babelHelpers['extends']({},this.$ConversationNubHeader3(),{onMenuShow:this.$ConversationNubHeader17.bind(this),onMenuHide:this.$ConversationNubHeader18.bind(this),onPermalinkClick:this.$ConversationNubHeader19.bind(this),showOnMount:this.$ConversationNubHeader5});this.$ConversationNubHeader4=p.render(o.createElement(q,r),n);}.bind(this),'ConversationNubHeader');};l.prototype.$ConversationNubHeader12=function(m){m.kill();this.$ConversationNubHeader20(true);};l.prototype.$ConversationNubHeader13=function(){this.$ConversationNubHeader20(false);};l.prototype.$ConversationNubHeader14=function(){this.$ConversationNubHeader20(false);};l.prototype.$ConversationNubHeader15=function(){if(this.$ConversationNubHeader4){this.$ConversationNubHeader4.toggle();}else this.$ConversationNubHeader20(true);};l.prototype.hideMenu=function(){this.$ConversationNubHeader4&&this.$ConversationNubHeader4.hide();};l.prototype.destroy=function(){var m=this.$ConversationNubHeader11();if(m&&this.$ConversationNubHeader4)c('ifRequired')('ReactDOM',function(n){n.unmountComponentAtNode(m);});this.$ConversationNubHeader2.release();};f.exports=l;}),null);
__d('ConversationNubTabsUpdateEventController',['Arbiter'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h='ConversationNub/tabsUpdated',i='ConversationNub/minimizedByUser',j='ConversationNub/maximizedByUser',k=false;function l(p){if(!k)c('Arbiter').inform(h,p);}function m(p){return c('Arbiter').subscribe(h,function(q,r){k=true;p(r);k=false;});}function n(p,q){q&&c('Arbiter').inform(i,{tabID:p.getTabID()});p.minimize();l();}function o(p,q){q&&c('Arbiter').inform(j,{tabID:p.getTabID()});p.popOut();l();}f.exports={TAB_MINIMIZED_BY_USER_EVENT:i,TAB_MAXIMIZED_BY_USER_EVENT:j,informTabsUpdated:l,subscribeToTabsUpdated:m,minimizeAndInformTabUpdate:n,popOutAndInformTabUpdate:o};}),null);
__d('ConversationNub',['csx','cx','Arbiter','CSS','ConversationNubHeader','ConversationNubTabsUpdateEventController','ConversationNubUtils','DOM','guid','EventListener','SubscriptionsHandler','URI','debounce'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('ConversationNubTabsUpdateEventController').minimizeAndInformTabUpdate,k=c('ConversationNubTabsUpdateEventController').popOutAndInformTabUpdate,l=10,m=500,n=100;function o(p,q,r){this.$ConversationNub1=p;this.$ConversationNub4=q;var s=r.permalink_uri,t=r.ft_id,u=r.title,v=r.init_without_badge,w=r.should_show_nux;this.$ConversationNub6=s?new (c('URI'))(s):null;this.$ConversationNub5=t;this.$ConversationNub7=u;this.$ConversationNub19=w===true;this.$ConversationNub8=c('guid')();this.$ConversationNub10=false;this.$ConversationNub12=null;this.$ConversationNub11=false;this.$ConversationNub13=false;this.$ConversationNub14=null;this.$ConversationNub18=0;this.$ConversationNub15={};this.$ConversationNub16={};this.$ConversationNub9=new (c('SubscriptionsHandler'))();this.$ConversationNub20();this.$ConversationNub21();if(v){this.$ConversationNub17=false;}else{this.$ConversationNub17=true;this.$ConversationNub22(1);this.$ConversationNub23(true);}}o.prototype.$ConversationNub20=function(){var p=this.$ConversationNub24();if(p){this.$ConversationNub9.addSubscriptions(c('EventListener').listen(p,'click',this.$ConversationNub25.bind(this)),c('EventListener').listen(p,'mouseenter',this.$ConversationNub26.bind(this)),c('EventListener').listen(p,'mouseleave',this.$ConversationNub27.bind(this)));var q=c('ConversationNubUtils').getCloseButtonElem(p);if(q)c('ConversationNubUtils').addCloseButtonListeners(q,this.$ConversationNub9,this.$ConversationNub28.bind(this));}var r=this.$ConversationNub29();if(r){this.$ConversationNub10=true;this.$ConversationNub9.addSubscriptions(c('EventListener').listen(r,'scroll',c('debounce')(this.$ConversationNub30.bind(this),n)),c('Arbiter').subscribe('reflow',this.$ConversationNub31.bind(this)));}};o.prototype.$ConversationNub21=function(){var p=this.$ConversationNub32();if(!p){this.$ConversationNub2=null;return;}var q=function(){return {permalinkURI:this.$ConversationNub6,ftID:this.$ConversationNub5,tabID:this.$ConversationNub4};}.bind(this),r=new (c('ConversationNubHeader'))(p,q);this.$ConversationNub9.addSubscriptions(r.subscribe('closeButton',this.$ConversationNub28.bind(this)),r.subscribe('showMenu',this.$ConversationNub33.bind(this)),r.subscribe('hideMenu',this.$ConversationNub34.bind(this)),r.subscribe('minimizeButton',this.$ConversationNub35.bind(this,true)),r.subscribe('clickHeader',this.$ConversationNub35.bind(this,true)),r.subscribe('menuPermalinkClick',this.$ConversationNub35.bind(this,false)));this.$ConversationNub2=r;};o.prototype.$ConversationNub32=function(){return this.$ConversationNub1&&c('DOM').scry(this.$ConversationNub1,".fbNubFlyoutTitlebar")[0];};o.prototype.$ConversationNub24=function(){return this.$ConversationNub1&&c('DOM').scry(this.$ConversationNub1,".fbNubButton")[0];};o.prototype.$ConversationNub29=function(){if(!this.$ConversationNub3&&this.$ConversationNub1)this.$ConversationNub3=c('DOM').scry(this.$ConversationNub1,".uiScrollableAreaWrap")[0];return this.$ConversationNub3;};o.prototype.$ConversationNub36=function(){var p=this.$ConversationNub24();if(p)return c('DOM').scry(p,"._37op")[0];return null;};o.prototype.$ConversationNub28=function(){c('ConversationNubUtils').informShouldCloseTab(this.$ConversationNub4,this,c('ConversationNubUtils').CLOSE_REASON_TAB_X_OUT);};o.prototype.$ConversationNub35=function(p){j(this,p);};o.prototype.$ConversationNub33=function(){this.$ConversationNub1&&c('CSS').addClass(this.$ConversationNub1,"_1uw3");};o.prototype.$ConversationNub34=function(){this.$ConversationNub1&&c('CSS').removeClass(this.$ConversationNub1,"_1uw3");};o.prototype.$ConversationNub25=function(){if(this.$ConversationNub11){j(this,true);}else k(this,true);};o.prototype.$ConversationNub26=function(){if(this.$ConversationNub13)this.$ConversationNub14=new Date();};o.prototype.$ConversationNub27=function(){var p=this.$ConversationNub14;if(p&&this.$ConversationNub13){var q=new Date();if(q-p>=m)this.$ConversationNub23(false);}this.$ConversationNub14=null;};o.prototype.$ConversationNub37=function(){var p=this.$ConversationNub29();if(p){var q=p.scrollHeight;if(q>0&&!this.$ConversationNub38(p))p.scrollTop=q;}};o.prototype.$ConversationNub38=function(p){p=p||this.$ConversationNub29();return !!(p&&p.scrollTop>=p.scrollHeight-p.clientHeight-l);};o.prototype.$ConversationNub30=function(){if(!this.$ConversationNub11)return;this.$ConversationNub10=this.$ConversationNub38();c('ConversationNubUtils').informShouldRecheckTabVisibility(this);};o.prototype.$ConversationNub31=function(){if(!this.$ConversationNub11)return;if(this.$ConversationNub10){this.$ConversationNub37();this.$ConversationNub12&&clearTimeout(this.$ConversationNub12);this.$ConversationNub12=setTimeout(function(){if(this.$ConversationNub10)this.$ConversationNub37();}.bind(this),100);}};o.prototype.$ConversationNub22=function(p){this.$ConversationNub18=p;var q=this.$ConversationNub36();if(!q)return;var r=p>0;if(r){c('DOM').setContent(q,p);c('CSS').show(q);}else{c('CSS').hide(q);c('DOM').setContent(q,p);}};o.prototype.$ConversationNub23=function(p){this.$ConversationNub13=p;if(this.$ConversationNub1)c('CSS').conditionClass(this.$ConversationNub1,"_53tf",p);};o.prototype.getRootDOM=function(){return this.$ConversationNub1;};o.prototype.getShouldShowNux=function(){return this.$ConversationNub19;};o.prototype.getTabID=function(){return this.$ConversationNub4;};o.prototype.getFeedbackTargetID=function(){return this.$ConversationNub5;};o.prototype.getPermalinkURI=function(){return this.$ConversationNub6;};o.prototype.getTitle=function(){return this.$ConversationNub7;};o.prototype.getBadgeCount=function(){return this.$ConversationNub18;};o.prototype.getIsRaised=function(){return this.$ConversationNub11;};o.prototype.getSessionID=function(){return this.$ConversationNub8;};o.prototype.markCommentsAsSeenWithoutBadging=function(p){p.forEach(function(q){this.$ConversationNub15[q]=true;}.bind(this));};o.prototype.attemptAddNewCommentsToBadge=function(p){p.forEach(function(s){if(this.$ConversationNub15[s])return;this.$ConversationNub15[s]=true;this.$ConversationNub16[s]=true;}.bind(this));var q=Object.keys(this.$ConversationNub16).length;if(this.$ConversationNub17)q+=1;var r=this.$ConversationNub18;this.$ConversationNub22(q);this.$ConversationNub23(q>0&&q>r);};o.prototype.clearBadge=function(){this.$ConversationNub16={};this.$ConversationNub17=false;this.$ConversationNub22(0);this.$ConversationNub23(false);};o.prototype.popOutAndInformTabUpdate=function(){this.popOut();c('ConversationNubTabsUpdateEventController').informTabsUpdated();};o.prototype.popOut=function(){if(this.$ConversationNub1)c('CSS').addClass(this.$ConversationNub1,"_5r93");this.$ConversationNub11=true;this.clearBadge();if(this.$ConversationNub10)this.$ConversationNub37();};o.prototype.minimize=function(){if(this.$ConversationNub1)c('CSS').removeClass(this.$ConversationNub1,"_5r93");this.$ConversationNub11=false;this.$ConversationNub2&&this.$ConversationNub2.hideMenu();this.clearBadge();};o.prototype.forceReflow=function(){this.$ConversationNub31();};o.prototype.destroy=function(){this.minimize();this.$ConversationNub9.release();this.$ConversationNub2&&this.$ConversationNub2.destroy();this.$ConversationNub2=null;this.$ConversationNub12&&clearTimeout(this.$ConversationNub12);if(this.$ConversationNub1){c('DOM').remove(this.$ConversationNub1);c('Arbiter').inform('ConversationNub/destroy',{root:this.$ConversationNub1});this.$ConversationNub1=null;}};f.exports=o;}),null);
__d('ConversationNubPermalinkUtils',['URI','isFacebookURI'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(l){return l.substr(-1)==='/'?l.slice(0,-1):l;}function i(l,m){var n=l.getPath(),o=m.getPath();return h(n)===h(o);}function j(l,m,n){var o=l.getQueryData(),p=m.getQueryData(),q=o[n],r=p[n];if(q==null&&r==null)return true;return q===r;}function k(l){var m=new (c('URI'))(window.location.href);return (m&&l&&c('isFacebookURI')(m)&&c('isFacebookURI')(l)&&i(m,l)&&j(m,l,'fbid')&&j(m,l,'story_fbid'));}f.exports={isOnPermalink:k};}),null);
__d('ConversationNubTabState',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.$ConversationNubTabState1={};this.$ConversationNubTabState2=[];this.$ConversationNubTabState3=Infinity;}h.prototype.setMaxDockTabs=function(i){this.$ConversationNubTabState3=i;};h.prototype.getNumDockTabs=function(){var i=this.$ConversationNubTabState3,j=this.getTotalTabCount();return Math.min(i,j);};h.prototype.getNumMenuTabs=function(){return this.getTotalTabCount()-this.getNumDockTabs();};h.prototype.addTab=function(i,j){var k=this.getTab(i);if(k)return;this.$ConversationNubTabState1[i]=j;this.$ConversationNubTabState2.push(j);};h.prototype.getTab=function(i){return this.$ConversationNubTabState1[i]||null;};h.prototype.getTabByFeedbackTarget=function(i){return this.$ConversationNubTabState2.find(function(j){return j.getTabID()===i;});};h.prototype.isTabInDock=function(i){var j=this.getTab(i);if(!j)return false;var k=this.$ConversationNubTabState4(j);return 0<=k&&k<this.getNumDockTabs();};h.prototype.$ConversationNubTabState4=function(i){return this.$ConversationNubTabState2.indexOf(i);};h.prototype.deleteTab=function(i){var j=this.getTab(i);if(j){delete this.$ConversationNubTabState1[i];var k=this.$ConversationNubTabState4(j);if(k>-1)this.$ConversationNubTabState2.splice(k,1);j.destroy();return true;}return false;};h.prototype.moveTabToDockLeft=function(i){var j=this.getTab(i);if(!j)return;var k=this.$ConversationNubTabState4(j),l=this.$ConversationNubTabState2.length,m=this.getNumDockTabs();if(k<0||l===0){return;}else if(m===0){if(k!==0){this.$ConversationNubTabState2.splice(k,1);this.$ConversationNubTabState2.unshift(j);}return;}var n=m-1;if(k===n)return;this.$ConversationNubTabState2.splice(k,1);if(k<n)n-=1;this.$ConversationNubTabState2.splice(n,0,j);};h.prototype.getUnsortedTabs=function(){return this.$ConversationNubTabState2;};h.prototype.getTotalTabCount=function(){return this.getUnsortedTabs().length;};h.prototype.getTabsForDockOldestFirst=function(){return this.$ConversationNubTabState2.slice(0,this.getNumDockTabs());};h.prototype.getTabsForDockNewestFirst=function(){return this.getTabsForDockOldestFirst().slice().reverse();};h.prototype.getTabsForMenu=function(){return this.$ConversationNubTabState2.slice(this.getNumDockTabs()).reverse();};f.exports=h;}),null);
__d('ConversationNubViewportManager',['DockTabsViewportCalculator','DockTabsViewportPinnedConversationTabUtils'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('DockTabsViewportPinnedConversationTabUtils').getMinRequiredWidthForFirstConvoTab,i=c('DockTabsViewportPinnedConversationTabUtils').getPinnedConvoSelectorWidth;function j(k,l,m){this.$ConversationNubViewportManager1=k;this.$ConversationNubViewportManager3=l;this.$ConversationNubViewportManager2=c('DockTabsViewportCalculator').getInstance(this.$ConversationNubViewportManager1);this.$ConversationNubViewportManager2&&this.$ConversationNubViewportManager2.registerPinnedConvoTabCallbacks(babelHelpers['extends']({},m,{pinnedConvoTabStateGetter:function(){return this.$ConversationNubViewportManager3;}.bind(this)}));}j.prototype.getNumDockTabsToShow=function(k){return this.getCouldFitAtLeastOneDockTab(k)?1:0;};j.prototype.getCouldFitAtLeastOneDockTab=function(k){var l=h();return l<=k;};j.prototype.forceRecalculatePinnedConvoTabs=function(k){this.$ConversationNubViewportManager2&&this.$ConversationNubViewportManager2.forceRecalculatePinnedConvoTabs(k);};f.exports=j;}),null);
__d('ConversationNubVisibilityDedupeUtils',['Bootloader','emptyFunction','ifRequired'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j){c('Bootloader').loadModules(["UFICommentVisibilityStore"],j,'ConversationNubVisibilityDedupeUtils');}function i(j){return c('ifRequired')('UFICommentVisibilityStore',function(k){return (k.isFeedbackTargetVisible(j));},c('emptyFunction').thatReturnsFalse);}f.exports={bootloadUFIVisibilityModule:h,isFeedbackTargetVisible:i};}),null);
__d("XNotificationNubStoryController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/conversation\/nub_story\/",{notif_id:{type:"Int",required:true},force_minimized:{type:"Bool",defaultValue:false}});}),null);
__d('NotificationConversationController',['csx','cx','Arbiter','AsyncRequest','Bootloader','ConversationNub','ConversationNubTabState','ConversationNubTabsUpdateEventController','ConversationNubPermalinkUtils','ConversationNubUtils','ConversationNubViewportManager','ConversationNubVisibilityDedupeUtils','CSS','DOM','NotificationConstants','NotificationUpdates','PinnedConversationNubsConfig','SubscriptionsHandler','URI','XNotificationNubStoryController','ge','ifRequired'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('NotificationConstants').PayloadSourceType,k=j.LIVE_SEND,l=j.OTHER_APPLICATION,m=c('ConversationNubVisibilityDedupeUtils').bootloadUFIVisibilityModule,n=c('ConversationNubVisibilityDedupeUtils').isFeedbackTargetVisible,o=1,p=new (c('ConversationNubTabState'))(),q={},r=null,s=null,t=null,u=null,v=null,w=null,x=false,y=null,z=null,aa=null,ba=null;function ca(){if(!s)s=c('DOM').scry(c('ge')('pagelet_dock'),"._1mw-")[0];return s;}function da(){if(!t){var ga=ca();if(ga)t=c('DOM').scry(ga,"._1tvj")[0];}return t;}function ea(){if(!u){var ga=ca();if(ga)u=c('DOM').scry(ga,"._2ikx .fbNubButton")[0];}return u;}var fa={init:function ga(){if(x)return;x=true;var ha='update-notifications',ia=new (c('SubscriptionsHandler'))();ia.addSubscriptions(c('NotificationUpdates').subscribe(ha,function(ja,ka){if(ka.payloadsource===k||ka.payloadsource===l){var la=ka.nodes;if(la&&la.length)this._handleNewNotifications(la);}}.bind(this)),c('ConversationNubTabsUpdateEventController').subscribeToTabsUpdated(this._onTabsUpdated.bind(this)),c('Arbiter').subscribe(c('ConversationNubUtils').CLOSE_TAB_EVENT,function(ja,ka){var la=ka||{},ma=la.tabID;if(ma)this._closeTab(ma);}.bind(this)));y=ia;m(function(ja){ia.addSubscriptions(ja.addListener(this._onUFICommentVisibilityStoreChanged.bind(this)));}.bind(this));},_recalculateDockSize:function ga(ha){var ia=r?r.getNumDockTabsToShow(ha):o;p.setMaxDockTabs(ia);},_onAvailableWidthChanged:function ga(ha,ia){this._recalculateDockSize(ha);if(ia){var ja=ia.tabToPromote,ka=ia.tabToOpenIfInDock;if(ja&&!p.isTabInDock(ja.getTabID()))p.moveTabToDockLeft(ja.getTabID());if(ka&&p.isTabInDock(ka.getTabID()))ka.popOut();}this._rerenderTabs(ha);},_onTabsUpdated:function ga(ha){r&&r.forceRecalculatePinnedConvoTabs(ha);},_rerenderTabs:function ga(ha){var ia=p.getTotalTabCount(),ja=p.getNumDockTabs(),ka=r&&r.getCouldFitAtLeastOneDockTab(ha),la=ia>0&&ka,ma=ja<ia&&la,na=ca();if(na){c('CSS').conditionClass(na,"_1tvf",la);c('CSS').conditionClass(na,"_1dex",ma);c('CSS').conditionClass(na,"_1tvi",ma);}var oa=c('PinnedConversationNubsConfig').pinnedToLeft?p.getTabsForDockOldestFirst():p.getTabsForDockNewestFirst();oa.forEach(function(qa){if(qa.getIsRaised())qa.clearBadge();});var pa=p.getTabsForMenu();this._renderDockedTabGroup(oa);this._renderSelectorNubMenu(pa);},_loadStoryFromNotif:function ga(ha,ia,ja,ka){if(!p.getTab(ia))this._requestStoryFromServer(ha,ja,ka);},_handleNewNotifications:function ga(ha){ha.forEach(function(ia){var ja=ia.pinnedConvoConfig,ka=ia.tracking;if(!ja)return;var la=ja.tab_id,ma=ja.ft_id,na=ja.permalink_uri,oa=JSON.parse(ka),pa=na?new (c('URI'))(na):null;this._loadStoryFromNotif(oa.alert_id,la,ma,pa);}.bind(this));},_requestStoryFromServer:function ga(ha,ia,ja){if(q[ha])return;var ka=c('XNotificationNubStoryController').getURIBuilder().setInt('notif_id',ha);if(c('ConversationNubPermalinkUtils').isOnPermalink(ja)||n(ia))ka.setBool('force_minimized',true);q[ha]=true;new (c('AsyncRequest'))().setURI(ka.getURI()).setAllowCrossPageTransition(true).setFinallyHandler(function(){delete q[ha];}).send();},_onUFICommentVisibilityStoreChanged:function ga(){var ha=false;p.getUnsortedTabs().forEach(function(ia){if(ia.getBadgeCount()>0&&n(ia.getFeedbackTargetID())){ia.clearBadge();ha=true;}});if(ha)c('ConversationNubTabsUpdateEventController').informTabsUpdated();},_onUFICommentsUpdated:function ga(ha){var ia=true;p.getUnsortedTabs().forEach(function(ja){var ka=ja.getFeedbackTargetID(),la=ha[ka],ma=la?Object.keys(la):[];if(ma.length){var na=ja.getBadgeCount();if(n(ka)){ja.markCommentsAsSeenWithoutBadging(ma);ja.clearBadge();}else ja.attemptAddNewCommentsToBadge(ma);var oa=ja.getBadgeCount();if(na!==oa)ia=true;}});if(ia)c('ConversationNubTabsUpdateEventController').informTabsUpdated();},_bootloadConversationNubSurveys:function ga(ha){if(ba)return;c('Bootloader').loadModules(["ConversationNubSurveys"],function(ia){if(!ba)ba=new ia(ha);},'NotificationConversationController');},_bootloadConversationNubLogger:function ga(ha,ia){if(aa){aa.addTab(ha);return;}c('Bootloader').loadModules(["ConversationNubLogger"],function(ja){if(!aa)aa=new ja(ia);aa.addTab(ha);},'NotificationConversationController');},_bootloadUFIUpdateManager:function ga(){if(z)return;c('Bootloader').loadModules(["ConversationNubUFICentralUpdateManager"],function(ha){if(z)return;z=new ha(this._onUFICommentsUpdated.bind(this));}.bind(this),'NotificationConversationController');},_renderDockedTabGroup:function ga(ha){var ia=da();if(!ia)return;c('Bootloader').loadModules(["React","ReactDOM","ConversationNubDockedTabGroup.react"],function(ja,ka,la){w=ka.render(ja.createElement(la,{dockTabs:ha}),ia);},'NotificationConversationController');},_onSelectCollapsedTab:function ga(ha){ha.popOut();c('ConversationNubTabsUpdateEventController').informTabsUpdated({tabToPromote:ha});},_renderSelectorNubMenu:function ga(ha){var ia=ea();if(!ia)return;c('Bootloader').loadModules(["React","ReactDOM","ConversationNubCollapsedSelectorMenu.react"],function(ja,ka,la){v=ka.render(ja.createElement(la,{menuTabs:ha,onTabSelected:this._onSelectCollapsedTab.bind(this)}),ia);}.bind(this),'NotificationConversationController');},_initViewportManager:function ga(){if(!r){var ha=ca();if(ha){var ia={onAvailableWidthChanged:this._onAvailableWidthChanged.bind(this)};r=new (c('ConversationNubViewportManager'))(ha,p,ia);}}},storyFromServer:function ga(ha,ia){if(!x)return;var ja=ia.tab_id,ka=ia.ft_id,la=ia.promote_on_init,ma=ia.attempt_open_on_init,na=p.getTab(ja);if(na){if(la||ma)c('ConversationNubTabsUpdateEventController').informTabsUpdated({tabToPromote:la?na:null,tabToOpenIfInDock:ma?na:null});return;}ia.init_without_badge=ia.init_without_badge||n(ka);var oa=new (c('ConversationNub'))(ha,ja,ia);p.addTab(ja,oa);this._bootloadUFIUpdateManager();this._initViewportManager();c('ConversationNubTabsUpdateEventController').informTabsUpdated({tabToPromote:la?oa:null,tabToOpenIfInDock:ma?oa:null});this._bootloadConversationNubSurveys(p);this._bootloadConversationNubLogger(ja,p);},_closeTab:function ga(ha){var ia=p.deleteTab(ha);if(ia)c('ConversationNubTabsUpdateEventController').informTabsUpdated();},unsubscribe:function ga(){y&&y.release();y=null;aa&&aa.destroy();aa=null;ba&&ba.destroy();ba=null;z&&z.destroy();z=null;c('ifRequired')('ReactDOM',function(ha){var ia=ea();if(v&&ia)ha.unmountComponentAtNode(ia);var ja=da();if(w&&ja)ha.unmountComponentAtNode(ja);});}};f.exports=fa;}),null);